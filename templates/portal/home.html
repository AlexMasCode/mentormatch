<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>{% if role == "MENTOR" %}–ü–∞–Ω–µ–ª—å –º–µ–Ω—Ç–æ—Ä–∞{% else %}–ü–∞–Ω–µ–ª—å –º–µ–Ω—Ç—ñ{% endif %}</title>
    <style>
        body {
            font-family: system-ui, Arial, sans-serif;
            margin: 2rem;
            line-height: 1.45
        }

        h2 {
            margin-top: 0
        }

        ul {
            padding-left: 1.2rem
        }

        .card {
            border: 1px solid #ccd;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem
        }
    </style>
</head>
<body>
<h2>–í—ñ—Ç–∞—î–º–æ, {{ first_name }}!</h2>

{% if role == "MENTOR" %}
    <div class="card">
        <h3>üë©‚Äçüè´ –ú–µ–Ω—é –º–µ–Ω—Ç–æ—Ä–∞</h3>
        <ul>
            <li><a href="{% url 'portal:create_availability' %}">–î–æ–¥–∞—Ç–∏ –≤—ñ–∫–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ</a></li>
            <li><a href="{% url 'portal:sessions' %}?as=mentor">–ó–∞–ø–∏—Ç–∏ –Ω–∞ —Å–µ—Å—ñ—ó</a></li>
            <li><a href="{% url 'portal:mentor_reviews' %}">–ú—ñ–π —Ä–µ–π—Ç–∏–Ω–≥&nbsp;/&nbsp;–≤—ñ–¥–≥—É–∫–∏</a></li>
        </ul>
    </div>
{% else %}
    <div class="card">
        <h3>üßë‚Äçüéì –ú–µ–Ω—é –º–µ–Ω—Ç—ñ</h3>
        <ul>
            <li><a href="{% url 'portal:find_mentor' %}">–ó–Ω–∞–π—Ç–∏ –º–µ–Ω—Ç–æ—Ä–∞‚Üí –∑–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏</a></li>
            <li><a href="{% url 'portal:sessions' %}?as=mentee">–ú–æ—ó —Å–µ—Å—ñ—ó</a></li>
            <li><a href="{% url 'portal:give_feedback' %}">–ó–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫ –ø—ñ—Å–ª—è —Å–µ—Å—ñ—ó</a></li>
        </ul>
    </div>
{% endif %}

<div class="card">
    <h3>üîî –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</h3>
    <div id="notif-box">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>
    <button id="mark-read" style="margin-top:.5rem;display:none">–ü–æ–∑–Ω–∞—á–∏—Ç–∏ –≤—Å—ñ —è–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ</button>
</div>

<p style="margin-top:2rem"><a href="{% url 'portal:logout' %}">üö™–í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç—É</a></p>

<script>
    const box = document.getElementById("notif-box");
    const btn = document.getElementById("mark-read");

    function render(list) {
        if (!list.length) {
            box.textContent = "–ù–µ–º–∞—î –Ω–æ–≤–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å";
            btn.style.display = "none";
            return;
        }
        box.innerHTML = "<ul>" + list.map(n => `<li>${n.message}</li>`).join("") + "</ul>";
        btn.style.display = "inline-block";
    }

    fetch("{{ notifications_api_url }}", {headers: {Authorization: "Bearer {{ access }}"}})
        .then(r => r.ok ? r.json() : Promise.reject()).then(data => render(data.results))
        .catch(() => box.textContent = "–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è");

    btn.onclick = () => fetch("{{ notifications_api_url }}mark-all-as-read/", {
        method: "PATCH",
        headers: {"Authorization": "Bearer {{ access }}", 'Content-Type': 'application/json'}
    }).then(() => {
        box.textContent = "–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ";
        btn.style.display = "none"
    });

    console.log("JWT access:", "{{ access }}");
</script>

<script>
    console.log("ACCESS TOKEN:", "{{ access }}");
</script>

</body>
</html>
